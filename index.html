<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Bowl Box Pool 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
</head>
<body>
    <div id="root"></div>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyB0vu82eWlWHmlVENOXEOuwKi9mUSgQEeM",
          authDomain: "superbowl-box-pool.firebaseapp.com",
          databaseURL: "https://superbowl-box-pool-default-rtdb.firebaseio.com",
          projectId: "superbowl-box-pool",
          storageBucket: "superbowl-box-pool.firebasestorage.app",
          messagingSenderId: "661968095769",
          appId: "1:661968095769:web:129978ee64083d9ec93888"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const gameDataRef = database.ref('gameData');

        const prefilledNames = [
          ['DaBoyz', 'Great Jammy Audrey', 'Lucky Laneys', 'MLou', 'MLou', 'Jane and Joe', 'Willis', 'Joe K', 'Frank J', 'Mary Jane G'],
          ['Sandy Haiko Digwood', 'Sharon T', 'DeeBra', '*Karen*', 'MaryAnn B', 'DaBoyz', 'Sharon T', 'Sharon T', 'Ann Marie S', 'MLou'],
          ['Jallison', 'Great Jammy Audrey', 'Kat', 'Brittany B', 'MaryAnn B', 'Debbie M', 'Gilly & Fletcher', 'Jane and Joe', 'Janice I', 'Jerry K'],
          ['Erin', 'Kuke', 'Erin', 'Becci', 'Harper', 'Colette Toflinski', 'Darrell Digwood', 'Trish I', 'Michael O', 'Pam Lyons'],
          ['Joe K', 'Kelly & Jah', 'Dannifer', 'Sharon T', 'Linda O\'Donnell', 'Jordie', 'Jenn O', 'Michelle & Kenny', 'Jane and Joe', 'Roseann S'],
          ['Zeke', 'Linda O\'Donnell', 'DaBoyz', 'Doodie', 'Mike Hegel', 'Ben G', 'Scooter', 'Ariel G', 'Ann N', 'Lucky Laneys'],
          ['Debbie M', 'Darrell Digwood', 'Lucky Laneys', 'Richard G', 'Lake House', 'Tom Lyons', 'Michelle & Kenny', 'Dave B', 'DaBoyz', 'Frank J'],
          ['Michelle & Kenny', 'C&C', 'Lisa S', 'DaBoyz', 'Michael O', 'Maureen G', 'Lucky Laneys', 'Saundersfest', 'Lori W', 'Sandy Haiko Digwood'],
          ['C&C', 'Lisa S', 'Colette Toflinski', 'Jillian D', 'Steve K', 'Carmen M', 'DaBoyz', 'Andrea G', 'Loni', 'Hegels'],
          ['Hegels', 'Linda K', 'Ann Marie S', 'Jenn L', 'Ariel G', '*Karen*', 'Jane and Joe', 'Michelle & Kenny', 'Ed B', 'Loie G']
        ];

        const hardcodedGrids = {
          quarters: {
            team1Numbers: [6, 7, 9, 5, 3, 2, 0, 8, 4, 1],
            team2Numbers: [4, 8, 5, 1, 3, 6, 9, 0, 7, 2],
            boxes: Array(10).fill(null).map((_, row) => 
              Array(10).fill(null).map((_, col) => ({
                number: row * 10 + col + 1,
                name: prefilledNames[row][col]
              }))
            )
          },
          scoreChanges: {
            team1Numbers: [1, 4, 2, 3, 7, 8, 5, 6, 9, 0],
            team2Numbers: [4, 7, 3, 1, 5, 2, 8, 9, 6, 0],
            boxes: Array(10).fill(null).map((_, row) => 
              Array(10).fill(null).map((_, col) => ({
                number: row * 10 + col + 1,
                name: prefilledNames[row][col]
              }))
            )
          },
          final: {
            team1Numbers: [7, 1, 5, 0, 2, 9, 8, 4, 3, 6],
            team2Numbers: [2, 1, 3, 8, 7, 4, 6, 9, 5, 0],
            boxes: Array(10).fill(null).map((_, row) => 
              Array(10).fill(null).map((_, col) => ({
                number: row * 10 + col + 1,
                name: prefilledNames[row][col]
              }))
            )
          }
        };

        let state = {
          activeTab: 'scoreChanges',
          gameScore: { team1: 0, team2: 0 },
          team1Name: 'Patriots',
          team2Name: 'Seahawks',
          isAdminUnlocked: false,
          isLiveMode: false,
          lastUpdate: null,
          currentPeriod: 0,
          gameClock: '15:00',
          pendingQuarterWinner: null,
          winners: {
            quarters: { Q1: null, Q2: null, Q3: null, Q4: null },
            scoreChanges: [],
            final: null
          },
          lastScore: { team1: 0, team2: 0 }
        };

        let liveScoreInterval = null;

        function setState(newState) {
          state = { ...state, ...newState };
          setTimeout(() => render(), 0);
        }

        function initializeFirebase() {
          const initialData = {
            gameScore: { team1: 0, team2: 0 },
            winners: {
              quarters: { Q1: null, Q2: null, Q3: null, Q4: null },
              scoreChanges: [],
              final: null
            },
            currentPeriod: 0,
            gameClock: '15:00',
            lastScore: { team1: 0, team2: 0 },
            isLiveMode: false
          };
          gameDataRef.set(initialData);
        }

        function checkInitialScoreChangeWinner() {
          if (!state.winners?.scoreChanges || state.winners.scoreChanges.length === 0) {
            const scGrid = hardcodedGrids.scoreChanges;
            const t1Index = scGrid.team2Numbers.findIndex(n => n === 0);
            const t2Index = scGrid.team1Numbers.findIndex(n => n === 0);
            
            if (t1Index >= 0 && t2Index >= 0) {
              const scWinner = scGrid.boxes[t2Index]?.[t1Index]?.name;
              
              if (scWinner) {
                const firstWinner = {
                  changeNumber: 1,
                  score: `0 ${state.team1Name}, 0 ${state.team2Name}`,
                  winner: scWinner,
                  box: scGrid.boxes[t2Index][t1Index].number,
                  time: new Date().toLocaleTimeString(),
                  payout: '$25',
                  isPayoutEligible: true
                };
                
                gameDataRef.update({
                  'winners/scoreChanges': [firstWinner]
                });
              }
            }
          }
        }

        function updateGameScore(team, value) {
          const newScore = { ...state.gameScore, [team]: parseInt(value) || 0 };
          gameDataRef.update({ gameScore: newScore });
          checkScoreChange(newScore);
        }

        function checkScoreChange(newScore) {
          const lastScore = state.lastScore || { team1: 0, team2: 0 };
          
          if (newScore.team1 !== lastScore.team1 || newScore.team2 !== lastScore.team2) {
            const t1Last = newScore.team1 % 10;
            const t2Last = newScore.team2 % 10;
            
            const scGrid = hardcodedGrids.scoreChanges;
            const t1Index = scGrid.team2Numbers.findIndex(n => n === t1Last);
            const t2Index = scGrid.team1Numbers.findIndex(n => n === t2Last);
            
            if (t1Index >= 0 && t2Index >= 0) {
              const scWinner = scGrid.boxes[t2Index]?.[t1Index]?.name;

              if (scWinner) {
                const currentChanges = state.winners?.scoreChanges || [];
                const changeNumber = currentChanges.length + 1;
                const isPayoutEligible = changeNumber <= 25;
                const payout = changeNumber === 25 ? `${625 - (24 * 25)}` : '$25';
                
                const newChange = {
                  changeNumber,
                  score: `${newScore.team1} ${state.team1Name}, ${newScore.team2} ${state.team2Name}`,
                  winner: scWinner,
                  box: scGrid.boxes[t2Index][t1Index].number,
                  time: new Date().toLocaleTimeString(),
                  payout,
                  isPayoutEligible
                };
                
                gameDataRef.update({
                  'winners/scoreChanges': [...currentChanges, newChange],
                  lastScore: newScore
                });
              }
            }
          }
        }

        function handleQuarterEnd(quarter) {
          const t1Last = state.gameScore.team1 % 10;
          const t2Last = state.gameScore.team2 % 10;
          
          const qGrid = hardcodedGrids.quarters;
          const t1Index = qGrid.team2Numbers.findIndex(n => n === t1Last);
          const t2Index = qGrid.team1Numbers.findIndex(n => n === t2Last);
          
          if (t1Index >= 0 && t2Index >= 0) {
            const qWinner = qGrid.boxes[t2Index]?.[t1Index]?.name;
            const boxNum = qGrid.boxes[t2Index]?.[t1Index]?.number;

            const payouts = { Q1: '$200', Q2: '$400', Q3: '$200', Q4: '$525' };

            if (qWinner) {
              const update = {};
              update[`winners/quarters/${quarter}`] = { 
                winner: qWinner, 
                box: boxNum,
                payout: payouts[quarter]
              };
              gameDataRef.update(update);
            }
          }
        }

        function handleFinalScore() {
          const t1Last = state.gameScore.team1 % 10;
          const t2Last = state.gameScore.team2 % 10;
          
          const fGrid = hardcodedGrids.final;
          const t1Index = fGrid.team2Numbers.findIndex(n => n === t1Last);
          const t2Index = fGrid.team1Numbers.findIndex(n => n === t2Last);
          
          if (t1Index >= 0 && t2Index >= 0) {
            const fWinner = fGrid.boxes[t2Index]?.[t1Index]?.name;
            const boxNum = fGrid.boxes[t2Index]?.[t1Index]?.number;

            if (fWinner) {
              gameDataRef.update({
                'winners/final': { 
                  winner: fWinner, 
                  box: boxNum,
                  payout: '$550'
                }
              });
            }
          }
        }

        function confirmQuarterWinner() {
          if (state.pendingQuarterWinner) {
            if (state.pendingQuarterWinner.quarter === 'FINAL') {
              handleFinalScore();
            } else {
              handleQuarterEnd(state.pendingQuarterWinner.quarter);
            }
            setState({ pendingQuarterWinner: null });
          }
        }

        function dismissQuarterWinner() {
          setState({ pendingQuarterWinner: null });
        }

        function toggleAdmin() {
          if (!state.isAdminUnlocked) {
            const password = prompt('Enter admin password:');
            if (password === 'Zeke2019') {
              setState({ isAdminUnlocked: true });
            } else {
              alert('Incorrect password');
            }
          } else {
            setState({ isAdminUnlocked: false });
          }
        }

        function toggleLiveMode() {
          const newLiveMode = !state.isLiveMode;
          
          // Save to Firebase so it persists and syncs across all devices
          gameDataRef.update({ isLiveMode: newLiveMode });
          
          setState({ isLiveMode: newLiveMode });

          if (newLiveMode) {
            fetchLiveScore();
            liveScoreInterval = setInterval(fetchLiveScore, 30000);
          } else {
            if (liveScoreInterval) {
              clearInterval(liveScoreInterval);
            }
          }
        }

        async function fetchLiveScore() {
          try {
            const response = await fetch('https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard');
            const data = await response.json();
            
            const superBowlGame = data.events?.find(event => {
              const competitors = event.competitions?.[0]?.competitors || [];
              const team1 = competitors.find(c => c.team.displayName.includes(state.team1Name));
              const team2 = competitors.find(c => c.team.displayName.includes(state.team2Name));
              return team1 && team2;
            });

            if (superBowlGame) {
              const competition = superBowlGame.competitions[0];
              const competitors = competition.competitors;
              const team1Data = competitors.find(c => c.team.displayName.includes(state.team1Name));
              const team2Data = competitors.find(c => c.team.displayName.includes(state.team2Name));
              
              if (team1Data && team2Data) {
                const newScore = {
                  team1: parseInt(team1Data.score) || 0,
                  team2: parseInt(team2Data.score) || 0
                };
                
                const status = competition.status;
                const period = status.period || 0;
                const displayClock = status.displayClock || '15:00';
                
                gameDataRef.update({
                  gameScore: newScore,
                  currentPeriod: period,
                  gameClock: displayClock
                });

                setState({ lastUpdate: new Date().toLocaleTimeString() });
                checkScoreChange(newScore);

                const statusType = status.type?.completed;

                if (period > state.currentPeriod && period <= 4) {
                  const quarterMap = { 1: 'Q1', 2: 'Q2', 3: 'Q3', 4: 'Q4' };
                  setState({
                    pendingQuarterWinner: {
                      quarter: quarterMap[period - 1],
                      score: { ...newScore }
                    }
                  });
                }

                if (statusType && period === 4 && !state.winners.final) {
                  setState({
                    pendingQuarterWinner: {
                      quarter: 'FINAL',
                      score: { ...newScore }
                    }
                  });
                }
              }
            }
          } catch (error) {
            console.error('Error fetching live scores:', error);
          }
        }

        function generateFBPost() {
          const quarters = state.winners?.quarters || {};
          const scoreChanges = state.winners?.scoreChanges || [];
          const final = state.winners?.final || null;
          
          let post = `üèà SUPER BOWL BOX POOL UPDATE üèà\n\n`;
          post += `Score: ${state.team1Name} ${state.gameScore.team1} - ${state.team2Name} ${state.gameScore.team2}\n\n`;
          
          post += `üèÜ QUARTERS:\n`;
          if (quarters && typeof quarters === 'object') {
            Object.entries(quarters).forEach(([q, data]) => {
              if (data) {
                post += `${q}: ${data.winner} (Box ${data.box}) - ${data.payout}\n`;
              }
            });
          }
          
          post += `\nüí∞ SCORE CHANGES (${scoreChanges.length} total):\n`;
          if (Array.isArray(scoreChanges)) {
            scoreChanges.slice(-5).forEach(sc => {
              post += `${sc.changeNumber}. [${sc.score}] - ${sc.winner} - ${sc.payout}\n`;
            });
            if (scoreChanges.length > 5) {
              post += `... and ${scoreChanges.length - 5} more\n`;
            }
          }
          
          if (final) {
            post += `\nüéâ FINAL: ${final.winner} (Box ${final.box}) - $550\n`;
          }
          
          return post;
        }

        function copyToClipboard() {
          navigator.clipboard.writeText(generateFBPost());
          alert('Copied! Ready to paste in Facebook.');
        }

        function renderGrid(bracket, gridData) {
          const t1Last = state.gameScore.team1 % 10;
          const t2Last = state.gameScore.team2 % 10;
          const patriotsColIndex = gridData.team2Numbers.findIndex(n => n === t1Last);
          const seahawksRowIndex = gridData.team1Numbers.findIndex(n => n === t2Last);

          let html = '<div class="overflow-x-auto -mx-6 px-6"><div class="inline-block min-w-full"><table class="border-collapse mx-auto"><tbody>';
          
          html += `<tr>
            <td class="w-24 h-14 bg-white border-2 border-black text-center font-bold text-sm leading-tight p-1">$25/box</td>
            <td class="w-16"></td>
            <td colspan="10" class="bg-gradient-to-r from-red-600 to-blue-800 text-white text-center py-2 font-bold text-xl border-2 border-black">${state.team1Name}</td>
          </tr>`;
          
          html += `<tr>
            <td rowspan="11" class="w-24 bg-gradient-to-b from-green-700 to-blue-900 text-white border-2 border-black relative">
              <div class="absolute inset-0 flex items-center justify-center">
                <div class="transform -rotate-90 whitespace-nowrap font-bold text-xl">${state.team2Name}</div>
              </div>
            </td>
            <td class="w-16 h-10 bg-gray-200 border-2 border-black text-center text-xs font-bold leading-tight p-0.5" style="font-size: 8px;">TBD after<br/>pool filled</td>`;
          
          gridData.team2Numbers.forEach((num, i) => {
            html += `<td class="w-16 h-10 border border-gray-400 text-center font-bold text-xl ${i === patriotsColIndex ? 'bg-yellow-300' : 'bg-white'}">${num}</td>`;
          });
          html += '</tr>';

          gridData.boxes.forEach((row, rowIndex) => {
            html += '<tr>';
            html += `<td class="w-16 h-16 border border-gray-400 text-center font-bold text-xl ${rowIndex === seahawksRowIndex ? 'bg-yellow-300' : 'bg-white'}">${gridData.team1Numbers[rowIndex]}</td>`;
            
            row.forEach((box, colIndex) => {
              const isWinningBox = seahawksRowIndex === rowIndex && patriotsColIndex === colIndex;
              const quarterWinner = state.winners?.quarters ? Object.entries(state.winners.quarters).find(([q, data]) => data?.box === box.number) : null;
              
              html += `<td class="w-20 h-20 sm:w-24 sm:h-24 border border-gray-300 p-1 ${isWinningBox ? 'bg-green-300 ring-2 ring-green-600' : 'bg-pink-100'}">
                <div class="flex flex-col items-center justify-center h-full">
                  <div class="text-gray-400 font-semibold mb-0.5" style="font-size: 7px;">${box.number}</div>
                  <div class="w-full h-12 text-center font-bold leading-tight text-gray-800 overflow-hidden break-words px-0.5" style="font-size: 10px;">${box.name}</div>
                  ${bracket === 'quarters' && quarterWinner ? `<div class="text-green-700 font-bold mt-0.5" style="font-size: 8px;">${quarterWinner[0]} ‚úì</div>` : ''}
                </div>
              </td>`;
            });
            
            html += '</tr>';
          });

          html += '</tbody></table></div></div>';
          return html;
        }

        function render() {
          const root = document.getElementById('root');
          
          let html = `
            <div class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 p-4">
              <div class="max-w-7xl mx-auto">
                ${state.pendingQuarterWinner && state.isAdminUnlocked ? `
                  <div class="fixed top-20 left-1/2 transform -translate-x-1/2 bg-yellow-400 text-black p-6 rounded-xl shadow-2xl z-50 animate-bounce border-4 border-yellow-600">
                    <div class="text-center">
                      <div class="text-2xl font-bold mb-2">üéâ ${state.pendingQuarterWinner.quarter} Ended!</div>
                      <div class="text-lg mb-4">Score: ${state.pendingQuarterWinner.score.team1} - ${state.pendingQuarterWinner.score.team2}</div>
                      <div class="flex gap-3 justify-center">
                        <button onclick="confirmQuarterWinner()" class="px-6 py-3 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700">‚úì Confirm Winner</button>
                        <button onclick="dismissQuarterWinner()" class="px-6 py-3 bg-red-600 text-white rounded-lg font-bold hover:bg-red-700">‚úó Dismiss</button>
                      </div>
                      <div class="text-xs mt-2 opacity-75">Admin Only</div>
                    </div>
                  </div>
                ` : ''}

                <div class="text-center mb-6">
                  <h1 class="text-5xl md:text-6xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent mb-2">Super Bowl Box Pool</h1>
                  <p class="text-gray-700 font-semibold text-lg">$25/box (1-100) ‚Ä¢ First Come First Serve</p>
                </div>

                <div class="bg-white rounded-xl shadow-xl p-6 mb-6">
                  <div class="grid grid-cols-3 gap-4 items-center">
                    <div class="text-center">
                      <div class="text-xl font-bold mb-2 bg-gradient-to-r from-red-600 to-blue-800 text-white px-4 py-1 rounded-lg inline-block">${state.team1Name}</div>
                      ${state.isAdminUnlocked ? `
                        <input type="text" inputmode="numeric" value="${state.gameScore.team1}" 
                          onchange="updateGameScore('team1', this.value)"
                          class="text-center text-6xl font-bold border-4 border-blue-800 rounded-lg px-4 py-3 w-full"
                          ${state.isLiveMode ? 'disabled' : ''}>
                      ` : `
                        <div class="text-center text-6xl font-bold border-4 border-blue-800 rounded-lg px-4 py-3 w-full bg-gray-50">${state.gameScore.team1}</div>
                      `}
                    </div>
                    
                    <div class="text-center">
                      <div class="text-gray-500 text-sm mb-2">
                        ${state.isLiveMode ? `
                          <span class="text-green-600 font-bold flex items-center justify-center gap-2">
                            <span class="animate-pulse">‚óè</span> LIVE
                            ${state.lastUpdate ? `<span class="text-xs text-gray-400">(${state.lastUpdate})</span>` : ''}
                          </span>
                        ` : '<span class="text-gray-600 font-semibold">GAME STATUS</span>'}
                      </div>
                      
                      ${!state.isAdminUnlocked ? `
                        <div class="space-y-1">
                          <div class="text-2xl font-bold text-gray-700">
                            ${state.currentPeriod === 0 ? 'Pregame' :
                              state.currentPeriod === 1 ? 'Q1' :
                              state.currentPeriod === 2 ? 'Q2' :
                              state.currentPeriod === 3 ? 'Q3' :
                              state.currentPeriod === 4 ? 'Q4' : 'Final'}
                          </div>
                          ${state.currentPeriod > 0 && state.currentPeriod <= 4 ? `
                            <div class="text-xl font-mono text-gray-600">${state.gameClock}</div>
                          ` : ''}
                        </div>
                      ` : `
                        <div class="flex gap-2 justify-center mb-2 flex-wrap">
                          <button onclick="handleQuarterEnd('Q1')" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600">Q1</button>
                          <button onclick="handleQuarterEnd('Q2')" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600">Q2</button>
                          <button onclick="handleQuarterEnd('Q3')" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600">Q3</button>
                          <button onclick="handleQuarterEnd('Q4')" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600">Q4</button>
                          <button onclick="handleFinalScore()" class="px-4 py-2 bg-green-500 text-white rounded-lg font-bold hover:bg-green-600">Final</button>
                        </div>
                        <button onclick="toggleLiveMode()" class="px-4 py-2 rounded-lg font-semibold text-sm ${
                          state.isLiveMode ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                        }">
                          ${state.isLiveMode ? '‚óè ESPN Live Mode ON' : 'Enable ESPN Live Scores'}
                        </button>
                      `}
                    </div>
                    
                    <div class="text-center">
                      <div class="text-xl font-bold mb-2 bg-gradient-to-r from-green-700 to-blue-900 text-white px-4 py-1 rounded-lg inline-block">${state.team2Name}</div>
                      ${state.isAdminUnlocked ? `
                        <input type="text" inputmode="numeric" value="${state.gameScore.team2}"
                          onchange="updateGameScore('team2', this.value)"
                          class="text-center text-6xl font-bold border-4 border-green-700 rounded-lg px-4 py-3 w-full"
                          ${state.isLiveMode ? 'disabled' : ''}>
                      ` : `
                        <div class="text-center text-6xl font-bold border-4 border-green-700 rounded-lg px-4 py-3 w-full bg-gray-50">${state.gameScore.team2}</div>
                      `}
                    </div>
                  </div>
                </div>

                <div class="flex gap-3 mb-6 overflow-x-auto bg-white rounded-xl p-3 shadow-lg">
                  ${[
                    { id: 'scoreChanges', label: 'üí∞ Score Changes', sub: '$25 each', color: 'from-green-400 to-emerald-500' },
                    { id: 'quarters', label: 'üèÜ Quarters', sub: '$200 / $400 / $525', color: 'from-blue-400 to-blue-500' },
                    { id: 'final', label: 'üéâ Final Score', sub: '$550', color: 'from-yellow-400 to-orange-500' },
                    { id: 'winners', label: 'üìã Winners History', sub: 'View all', color: 'from-purple-400 to-pink-500' }
                  ].map(tab => `
                    <button onclick="setState({ activeTab: '${tab.id}' })" 
                      class="flex-1 px-4 py-3 rounded-lg font-bold transition-all text-center ${
                        state.activeTab === tab.id
                          ? `bg-gradient-to-r ${tab.color} text-white shadow-xl transform scale-105`
                          : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                      }">
                      <div class="text-sm">${tab.label}</div>
                      <div class="text-xs opacity-80">${tab.sub}</div>
                    </button>
                  `).join('')}
                </div>

                <div class="bg-white rounded-xl shadow-xl p-6 mb-6">
                  ${state.activeTab !== 'winners' ? `
                    <div class="mb-4 text-center bg-blue-50 py-2 px-4 rounded-lg">
                      <span class="text-sm font-semibold text-blue-700">‚ú® Each bracket has independent number assignments</span>
                    </div>
                  ` : ''}
                  
                  <div id="grid-container"></div>
                  <div id="winners-container"></div>
                </div>

                ${state.isAdminUnlocked ? `
                  <div class="fixed bottom-0 left-0 right-0 bg-gradient-to-r from-orange-600 to-red-600 text-white p-4 shadow-2xl z-50">
                    <div class="max-w-7xl mx-auto flex justify-between items-center flex-wrap gap-4">
                      <div class="flex items-center gap-4 flex-wrap">
                        <span class="font-bold">üîì Admin Mode Active</span>
                        <span class="text-sm opacity-90">Live updates enabled for all viewers</span>
                      </div>
                      <button onclick="toggleAdmin()" class="px-6 py-2 bg-white text-red-600 rounded-lg font-semibold hover:bg-gray-100">Lock Admin</button>
                    </div>
                  </div>
                ` : `
                  <div class="fixed bottom-4 right-4 z-50">
                    <button onclick="toggleAdmin()" class="p-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-full shadow-xl hover:shadow-2xl text-2xl transform hover:scale-110 transition-all" title="Admin Access">üîí</button>
                  </div>
                `}
              </div>
            </div>
          `;

          root.innerHTML = html;

          // Render content based on active tab
          const gridContainer = document.getElementById('grid-container');
          const winnersContainer = document.getElementById('winners-container');
          
          if (gridContainer) {
            if (state.activeTab === 'scoreChanges') {
              gridContainer.innerHTML = renderGrid('scoreChanges', hardcodedGrids.scoreChanges);
            } else if (state.activeTab === 'quarters') {
              gridContainer.innerHTML = renderGrid('quarters', hardcodedGrids.quarters);
            } else if (state.activeTab === 'final') {
              gridContainer.innerHTML = renderGrid('final', hardcodedGrids.final);
            } else {
              gridContainer.innerHTML = '';
            }
          }
          
          if (winnersContainer && state.activeTab === 'winners') {
            renderWinnersSummary();
          } else if (winnersContainer) {
            winnersContainer.innerHTML = '';
          }
          
          isRendering = false;
        }

        function renderWinnersSummary() {
          const container = document.getElementById('winners-container');
          if (!container) return;
          
          const quarters = state.winners?.quarters || {};
          const scoreChanges = state.winners?.scoreChanges || [];
          const final = state.winners?.final || null;
          
          let html = `
            <div class="space-y-6">
              <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold">Winners Summary</h2>
                ${state.isAdminUnlocked ? `
                  <button onclick="copyToClipboard()" class="px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 flex items-center gap-2">
                    üìã Copy for Facebook
                  </button>
                ` : ''}
              </div>

              <div class="grid md:grid-cols-3 gap-6">
                <div class="bg-blue-50 p-4 rounded-xl shadow-md">
                  <h3 class="font-bold mb-3 text-lg">üèÜ Quarters</h3>
                  ${quarters && typeof quarters === 'object' ? Object.entries(quarters).map(([q, data]) => `
                    <div class="mb-2 text-sm">
                      <strong>${q}:</strong> ${data?.winner || 'TBD'}
                      ${data?.payout ? `<span class="text-green-600 ml-2">${data.payout}</span>` : ''}
                    </div>
                  `).join('') : '<p class="text-gray-500">No quarters completed yet</p>'}
                </div>

                <div class="bg-green-50 p-4 rounded-xl shadow-md">
                  <h3 class="font-bold mb-3 text-lg">üí∞ Score Changes</h3>
                  <div class="text-sm mb-2">
                    Total: ${scoreChanges.length}
                    ${scoreChanges.length >= 25 ? '<span class="block text-xs text-red-600 mt-1">‚ö†Ô∏è Maximum 25 payouts reached</span>' : ''}
                  </div>
                  <div class="max-h-96 overflow-y-auto text-xs">
                    ${scoreChanges.length === 0 ? 
                      '<p class="text-gray-500 italic">First change will be recorded at 0-0</p>' :
                      scoreChanges.map(sc => `
                        <div class="mb-2 pb-2 border-b border-green-200 ${!sc.isPayoutEligible ? 'opacity-50' : ''}">
                          <div class="font-semibold">${sc.changeNumber}. [${sc.score}] - ${sc.winner}</div>
                          <div class="text-xs mt-1 ${sc.isPayoutEligible ? 'text-green-600' : 'text-red-600'} font-bold">${sc.payout}</div>
                          <div class="text-xs text-gray-500">${sc.time}</div>
                        </div>
                      `).join('')
                    }
                  </div>
                </div>

                <div class="bg-yellow-50 p-4 rounded-xl shadow-md">
                  <h3 class="font-bold mb-3 text-lg">üéâ Final Score</h3>
                  <div class="text-center py-6">
                    <div class="text-xl font-bold">${final?.winner || 'TBD'}</div>
                    ${final?.payout ? `<div class="text-lg text-green-600 font-bold mt-2">${final.payout}</div>` : ''}
                  </div>
                </div>
              </div>

              ${state.isAdminUnlocked ? `
                <div class="bg-gray-50 p-4 rounded-xl shadow-md">
                  <h3 class="font-bold mb-3">Facebook Post Preview:</h3>
                  <pre class="whitespace-pre-wrap text-sm bg-white p-4 rounded border font-mono">${generateFBPost()}</pre>
                </div>
              ` : ''}
            </div>
          `;

          container.innerHTML = html;
        }

        gameDataRef.on('value', (snapshot) => {
          const data = snapshot.val();
          if (data) {
            const newState = {
              gameScore: data.gameScore || state.gameScore,
              winners: data.winners || state.winners,
              currentPeriod: data.currentPeriod || 0,
              gameClock: data.gameClock || '15:00',
              lastScore: data.lastScore || { team1: 0, team2: 0 },
              isLiveMode: data.isLiveMode || false
            };
            
            // Start/stop live mode based on Firebase state
            if (newState.isLiveMode && !liveScoreInterval) {
              liveScoreInterval = setInterval(fetchLiveScore, 30000);
            } else if (!newState.isLiveMode && liveScoreInterval) {
              clearInterval(liveScoreInterval);
              liveScoreInterval = null;
            }
            
            // Only update if something actually changed
            if (JSON.stringify(newState) !== JSON.stringify({
              gameScore: state.gameScore,
              winners: state.winners,
              currentPeriod: state.currentPeriod,
              gameClock: state.gameClock,
              lastScore: state.lastScore,
              isLiveMode: state.isLiveMode
            })) {
              setState(newState);
            }
          } else {
            initializeFirebase();
          }
        });

        setTimeout(() => {
          checkInitialScoreChangeWinner();
        }, 1000);

        render();
    </script>
</body>
</html>